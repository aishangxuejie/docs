# 运行控制

配置 systemctl 后的启动方式

- 状态：`ssytemctl status nginx`
- 启动：`systemctl start nginx`
- 关闭：`systemctl stop nginx`
- 重启：`systemctl restart nginx`

常用命令

> 使用 nginx 命令前要进入 `nginx` 目录：`cd /usr/local/nginx/sbin`

- 查看 nginx 版本号：`./nginx -v`
- 启动 nginx：`./nginx`
- 重载 nginx：`./nginx -s reload`

# 配置文件

Nginx的默认附加配置文件存放位置的总结：/etc/nginx/conf.d/、/etc/nginx/sites-available/和/etc/nginx/sites-enabled。

## /nginx.conf

/etc/nginx/nginx.conf

先加载nginx.conf，然后加载conf.d/，最后加载sites-enabled/

```
include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/*;
```

## /etc/nginx/sites-available/ 可用的 Nginx 网站配置文件目录。

为每个要运营的域名创建文件并编写配置。
这里只是放置可用的配置文件，放置在这里的文件不会直接反映在Nginx配置中。

![image-20241119095257902](F:/OneDrive/markdown/assets/image-20241119095257902.png)

## /etc/nginx/sites-enabled/ 可在以下位置找到：

从主要配置文件(/etc/nginx/nginx.conf)中加载。
在/etc/nginx/sites-enabled/目录下创建/etc/nginx/sites-available/目录中文件的符号链接。如果要禁用配置，则删除符号链接，配置文件仍然保留在/etc/nginx/sites-available/中。

![image-20241119095220875](F:/OneDrive/markdown/assets/image-20241119095220875.png)

## 运用差异

**sites-enabled** 中则只拥有 **sites-available** 文件夹下 **default** 的软链接，结合前面得出：

- **sites-enabled** 下的文件，会作为 **nginx.conf** 的一部分加载
- **sites-enabled** 下的用于存放 **sites-available** 中文件的软连接

**sites-enabled** 意为已开启的网站，将 **sites-available** 中的配置文件链接到此处，以使配置文件被 **nginx** 加载。

作者：Widecss
链接：https://www.jianshu.com/p/42c4ffd044e6
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

## 默认模板

### default.conf

/etc/nginx/conf.d/default.conf

```
server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;



location /vpn {
    proxy_pass http://127.0.0.1:7001;
}


    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}

```

```
# Default server configuration
#
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name 99kids.icu;

        #location / {
        #       # First attempt to serve request as file, then
        #       # as directory, then fall back to displaying a 404.
        #       try_files $uri $uri/ =404;
        #}
        location / {
                proxy_pass  http://127.0.0.1:7001;
        }
        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}
}

```

